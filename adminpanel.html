<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spa Admin Panel</title>
  <link rel="stylesheet" href="adminpanel2.css">
</head>
<body>
  <!-- Sidebar na part -->
   <section class="Sidebar" id="Bookings"></section>
  <div class="sidebar">
    <h2>Admin Panel</h2>
    <ul>
      <li><a href="adminpanel.html"><strong>Bookings</strong></a></li>
      <li><a href="editservice.html"><strong>Services</strong></a></li>
      <li><a href="index.html"><strong>Log out</strong></a></li>
    </ul>
  </div>

     
  <div class="main">
    <!-- Top Header -->
    <div class="header">
      <div>
        <h1>Spa Admin Dashboard</h1>
        <p class="sub">Manage bookings, confirm appointments and update services</p>
      </div>
      <div class="admin-info">
        <div class="profile">
          <div class="avatar">A</div>
          <div class="meta">
            <div class="name">Admin</div>
            <div class="role">Administrator</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Dashboard Cards -->
    <div class="cards">
      <div class="card">
        <h3>Pending</h3>
        <p id="card-pending">0</p>
      </div>
      <div class="card">
        <h3>Confirmed</h3>
        <p id="card-confirmed">0</p>
      </div>
      <div class="card">
        <h3>Completed</h3>
        <p id="card-completed">0</p>
      </div>
    </div>

    <!-- Table Section -->
    <div class="table-section">
      <div class="table-top">
        <h2>Upcoming Appointments</h2>
        <div class="controls">
          <input id="search" placeholder="Search client or service...">
          <select id="filter-status">
            <option value="ALL">All</option>
            <option value="PENDING">Pending</option>
            <option value="CONFIRMED">Confirmed</option>
            <option value="CANCELLED">Cancelled</option>
          </select>
        </div>
      </div>

      <table class="bookings-table">
        <thead>
          <tr>
            <th>Client</th>
            <th>Service</th>
            <th>Date</th>
            <th>Time</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="bookings-body">
          <!-- dynamic rows inserted here -->
        </tbody>
      </table>
      <p id="empty-message" style="display:none; color:#666; margin-top:10px;">No bookings found.</p>
    </div>
  </div>

  <script>
    // keep previous admin JS but add small UX improvements
    const API_BASE = 'http://localhost:3000/api/bookings';
    const token = localStorage.getItem('token');

    async function fetchBookings(status='PENDING'){
      if (!token) return;
      const url = status === 'ALL' ? `${API_BASE}/admin/all` : `${API_BASE}/admin/pending`;
      const res = await fetch(url, { headers: { 'Authorization': 'Bearer ' + token }});
      const data = await res.json();
      return data.data || [];
    }

    async function refresh(){
      const statusFilter = document.getElementById('filter-status').value;
      const rows = await fetchBookings(statusFilter);
      const tbody = document.getElementById('bookings-body');
      tbody.innerHTML = '';

      if (!rows.length){
        document.getElementById('empty-message').style.display = 'block';
      } else {
        document.getElementById('empty-message').style.display = 'none';
      }

      let pending=0,confirmed=0,completed=0;

      rows.forEach(b => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${b.CLIENT_NAME || b.NAME || b.EMAIL_ADDRESS || ''}</td>
          <td>${b.SERVICE_NAME || ''}</td>
          <td>${b.BOOKING_DATE ? new Date(b.BOOKING_DATE).toLocaleDateString() : ''}</td>
          <td>${b.BOOKING_TIME || ''}</td>
          <td><span class="badge ${b.STATUS_NAME.toLowerCase()}">${b.STATUS_NAME}</span></td>
          <td>
            <button class="btn-confirm" data-id="${b.BOOKING_ID}">Confirm</button>
            <button class="btn-cancel" data-id="${b.BOOKING_ID}">Cancel</button>
          </td>`;
        tbody.appendChild(tr);
        

        if (b.STATUS_NAME === 'PENDING') pending++;
        if (b.STATUS_NAME === 'CONFIRMED') confirmed++;
        if (b.STATUS_NAME === 'COMPLETED') completed++;
      });

      document.getElementById('card-pending').textContent = pending;
      document.getElementById('card-confirmed').textContent = confirmed;
      document.getElementById('card-completed').textContent = completed;

      document.querySelectorAll('.btn-confirm').forEach(btn=>btn.addEventListener('click',()=>updateStatus(btn.dataset.id,'CONFIRMED')));
      document.querySelectorAll('.btn-cancel').forEach(btn=>btn.addEventListener('click',()=>updateStatus(btn.dataset.id,'CANCELLED')));
    }

    async function updateStatus(id,status){
      if (!token) return alert('Please login as admin');
      const res = await fetch(`${API_BASE}/${id}/status`,{
        method:'PUT',
        headers:{ 'Content-Type':'application/json','Authorization':'Bearer '+token },
        body: JSON.stringify({ status })
      });
      const data = await res.json();
      if (!res.ok) return alert(data.message || 'Failed');
      refresh();
    }

    document.getElementById('filter-status').addEventListener('change', refresh);
    document.getElementById('search').addEventListener('input', (e)=>{ /* optional search filter */ });

    // initial load and polling
    refresh();
    setInterval(refresh, 8000);
  </script>
</body>
</html>